# Nat configuration
*nat
# Clear the config
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]


# NAT configuration between the dmz and private network with a default route to the public network
-A POSTROUTING -s 192.168.100.0/24 -o eth2 -j MASQUERADE
-A POSTROUTING -s 192.168.200.0/24 -o eth2 -j MASQUERADE
-A POSTROUTING -s 192.168.100.0/24 -d 192.168.200.0/24 -j MASQUERADE
-A POSTROUTING -s 192.168.200.0/24 -d 192.168.100.0/24 -j MASQUERADE

# NAT configuration to allow the public network users to acces the dns server
-A PREROUTING -s 10.10.10.0/24 -p udp --dport 53 -j DNAT --to-destination 192.168.100.3:53
-A PREROUTING -s 10.10.10.0/24 -p tcp --dport 53 -j DNAT --to-destination 192.168.100.3:53
-A POSTROUTING -s 192.168.100.3 -d 10.10.10.0/24 -p udp --sport 53 -j MASQUERADE
-A POSTROUTING -s 192.168.100.3 -d 10.10.10.0/24 -p tcp --sport 53 -j MASQUERADE

COMMIT